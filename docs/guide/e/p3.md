
# 1px 问题

> 1px 问题的本质：是由于设备像素比（devicePixelRatio）大于 1，导致 1 个 CSS 像素对应多个物理像素，从而使得 1px 边框在高清屏幕上显示得更粗。

## 🧩 一、问题现象

在一些高清设备（如 iPhone、iPad 等 Retina 屏幕设备）上，使用 CSS 设置的 `border: 1px solid #000` 或者 `box-shadow` 等 1px 样式时，实际显示的线条比预期更粗（看起来像 2px），这在视觉上显得不够精致。


## 🧠 二、问题原理

### 1. 物理像素 vs 逻辑像素

- **物理像素（device pixel）**：屏幕上的真实像素点。
- **逻辑像素（CSS pixel）**：浏览器中 CSS 使用的单位，是抽象的单位。

在 Retina 屏幕等高清设备上，1 个 CSS 像素可能对应多个物理像素。例如：

```javascript
window.devicePixelRatio // 可能返回 2 或 3
```

如果 `devicePixelRatio = 2`，那么 1px 的 CSS 像素实际上会占用 2x2 个物理像素。

### 2. 为什么 1px 看起来粗？

- 浏览器在高清屏上渲染 1px 时，为了适应多个物理像素，可能会使用**插值算法**，导致线条模糊或变粗。
- 尤其是当设备像素比大于 1 时（如 2x、3x），这种现象更明显。


## 🛠️ 三、解决方案

### ✅ 1. 使用 `transform: scaleY(0.5)`（伪元素方式）

通过伪元素创建一个 1px 边框，并使用 `transform` 缩放。

```css
.border {
  position: relative;
}

.border::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 1px;
  background: #000;
  transform: scaleY(0.5);
}
```

> 优点：兼容性好，适用于大多数设备。  
> 缺点：需要手动处理，不能直接使用 `border` 属性。


### ✅ 2. 使用 `box-shadow`

```css
.box {
  box-shadow: 0 0 0 1px #000;
}
```

> 在某些设备上，`box-shadow` 渲染的 1px 更精细。


### ✅ 3. 使用 `viewport` + `rem` 动态适配（结合 flexible.js）

使用 [flexible.js](https://github.com/amfe/lib-flexible) 等库动态设置 `html` 的 `font-size` 和 `viewport`，从而实现适配。

> 这种方案适用于响应式布局，但对 1px 问题的解决不如伪元素直接。


### ✅ 4. 使用 `postcss-write-svg` 插件（PostCSS）

通过 PostCSS 插件自动将 1px 边框转换为 SVG 背景图。

```css
.border {
  border: 1px solid #000;
}
```

会被编译为：

```css
.border {
  background-image: url("data:image/svg+xml;charset=utf-8,<svg xmlns='http://www.w3.org/2000/svg' height='1px' ... ></svg>");
}
```

> 优点：自动化，适合工程化项目。  
> 缺点：需要构建工具支持。


### ✅ 5. 使用 `devicePixelRatio` 动态判断（JavaScript 方案）

可以使用 JavaScript 判断设备像素比，动态设置样式。

```js
if (window.devicePixelRatio >= 2) {
  document.querySelector('.box').style.border = '0.5px solid #000';
}
```

> 注意：不是所有浏览器都支持小数像素（如某些安卓浏览器不支持 `0.5px`）。


## 📌 四、总结

| 方法 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| `transform: scaleY(0.5)` | 简单有效 | 需要伪元素 | 移动端通用 |
| `box-shadow` | 简洁 | 效果不稳定 | 简单边框 |
| `flexible.js` | 整体适配 | 需引入库 | 大型响应式项目 |
| `postcss-write-svg` | 自动化 | 需构建工具 | 工程化项目 |
| `0.5px` | 简单 | 兼容性差 | 支持小数像素的设备 |


