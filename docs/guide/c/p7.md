 # Promise

**Promise** 是 JavaScript 中用于处理异步操作的对象，它代表一个**尚未完成但未来会完成（或失败）的操作**，避免了传统的回调地狱（Callback Hell），使异步代码更清晰、更易管理。  


## **1. Promise 的三种状态**  
Promise 有三种状态，**一旦状态改变，就不可逆**：  
1. **Pending（等待中）**：初始状态，既未完成也未拒绝。  
2. **Fulfilled（已成功）**：操作成功完成，执行 `resolve()`。  
3. **Rejected（已失败）**：操作失败，执行 `reject()`。  

状态转换：  
```bash
Pending → Fulfilled（resolve）  
Pending → Rejected（reject）  
```


## **2. 基本语法**  
```javascript
const promise = new Promise((resolve, reject) => {
  // 异步操作（如 API 请求、定时器等）
  if (/* 成功 */) {
    resolve("成功的结果"); // 进入 .then()
  } else {
    reject("错误信息");    // 进入 .catch()
  }
});

// 使用 Promise
promise
  .then(result => console.log(result))  // 处理成功
  .catch(error => console.error(error)) // 处理失败
  .finally(() => console.log("无论成功失败都会执行"));
```


## **3. Promise 链式调用**  
`.then()` 可以**链式调用**，每个 `.then()` 返回一个新的 Promise：  
```javascript
fetchData() // 假设返回一个 Promise
  .then(data => processData(data))  // 处理第一次结果
  .then(processedData => saveData(processedData)) // 处理第二次结果
  .catch(error => console.error("出错:", error));
```


## **4. Promise 的静态方法**  
| 方法 | 说明 |
|------|------|
| `Promise.resolve(value)` | 返回一个已成功的 Promise |
| `Promise.reject(error)` | 返回一个已失败的 Promise |
| `Promise.all([p1, p2, p3])` | **所有成功才成功**，任一失败则整体失败 |
| `Promise.race([p1, p2])` | **第一个完成（无论成功/失败）的 Promise 决定结果** |
| `Promise.allSettled([p1, p2])` | **所有 Promise 完成（无论成功/失败）才返回** |
| `Promise.any([p1, p2])` | **第一个成功的 Promise 决定结果**，全部失败才失败 |

**示例：`Promise.all`（并行执行多个异步任务）**  
```javascript
const p1 = fetch("/api/data1");
const p2 = fetch("/api/data2");

Promise.all([p1, p2])
  .then(([res1, res2]) => console.log(res1, res2))
  .catch(error => console.error("至少一个请求失败:", error));
```


## **5. 与 async/await 结合**  
`async/await` 是 Promise 的语法糖，让异步代码看起来像同步代码：  
```javascript
async function fetchData() {
  try {
    const response = await fetch("/api/data"); // 等待 Promise 完成
    const data = await response.json();
    console.log(data);
  } catch (error) {
    console.error("请求失败:", error);
  }
}
fetchData();
```


## **6. 常见问题**  
### **Q1: Promise 和回调函数有什么区别？**  
✅ **Promise 优点**：
- 避免回调地狱（Callback Hell），代码更扁平化。  
- 支持链式调用，错误处理更集中（`.catch`）。  
- 提供 `Promise.all`、`Promise.race` 等高级并发控制。  

### **Q2: `new Promise` 和 `Promise.resolve` 的区别？**  
- `new Promise` 用于创建新的 Promise。  
- `Promise.resolve` 直接返回一个已成功的 Promise。  

### **Q3: 如何取消 Promise？**  
Promise **本身不支持取消**，但可以通过 `AbortController`（用于 `fetch`）或第三方库（如 `axios` 的 `CancelToken`）实现类似功能。  


## **总结**  
| 特性 | 说明 |
|------|------|
| **状态** | Pending → Fulfilled / Rejected |
| **链式调用** | `.then().catch().finally()` |
| **静态方法** | `all`、`race`、`allSettled`、`any` |
| **async/await** | 更直观的异步写法 |

Promise 是现代 JavaScript 异步编程的核心，掌握它才能更好地使用 `async/await` 和高级异步控制！ 🚀 
