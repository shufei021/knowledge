 # Promise

**Promise** æ˜¯ JavaScript ä¸­ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„å¯¹è±¡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª**å°šæœªå®Œæˆä½†æœªæ¥ä¼šå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰çš„æ“ä½œ**ï¼Œé¿å…äº†ä¼ ç»Ÿçš„å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰ï¼Œä½¿å¼‚æ­¥ä»£ç æ›´æ¸…æ™°ã€æ›´æ˜“ç®¡ç†ã€‚  


## **1. Promise çš„ä¸‰ç§çŠ¶æ€**  
Promise æœ‰ä¸‰ç§çŠ¶æ€ï¼Œ**ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸å¯é€†**ï¼š  
1. **Pendingï¼ˆç­‰å¾…ä¸­ï¼‰**ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢æœªå®Œæˆä¹Ÿæœªæ‹’ç»ã€‚  
2. **Fulfilledï¼ˆå·²æˆåŠŸï¼‰**ï¼šæ“ä½œæˆåŠŸå®Œæˆï¼Œæ‰§è¡Œ `resolve()`ã€‚  
3. **Rejectedï¼ˆå·²å¤±è´¥ï¼‰**ï¼šæ“ä½œå¤±è´¥ï¼Œæ‰§è¡Œ `reject()`ã€‚  

çŠ¶æ€è½¬æ¢ï¼š  
```bash
Pending â†’ Fulfilledï¼ˆresolveï¼‰  
Pending â†’ Rejectedï¼ˆrejectï¼‰  
```


## **2. åŸºæœ¬è¯­æ³•**  
```javascript
const promise = new Promise((resolve, reject) => {
  // å¼‚æ­¥æ“ä½œï¼ˆå¦‚ API è¯·æ±‚ã€å®šæ—¶å™¨ç­‰ï¼‰
  if (/* æˆåŠŸ */) {
    resolve("æˆåŠŸçš„ç»“æœ"); // è¿›å…¥ .then()
  } else {
    reject("é”™è¯¯ä¿¡æ¯");    // è¿›å…¥ .catch()
  }
});

// ä½¿ç”¨ Promise
promise
  .then(result => console.log(result))  // å¤„ç†æˆåŠŸ
  .catch(error => console.error(error)) // å¤„ç†å¤±è´¥
  .finally(() => console.log("æ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œ"));
```


## **3. Promise é“¾å¼è°ƒç”¨**  
`.then()` å¯ä»¥**é“¾å¼è°ƒç”¨**ï¼Œæ¯ä¸ª `.then()` è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼š  
```javascript
fetchData() // å‡è®¾è¿”å›ä¸€ä¸ª Promise
  .then(data => processData(data))  // å¤„ç†ç¬¬ä¸€æ¬¡ç»“æœ
  .then(processedData => saveData(processedData)) // å¤„ç†ç¬¬äºŒæ¬¡ç»“æœ
  .catch(error => console.error("å‡ºé”™:", error));
```


## **4. Promise çš„é™æ€æ–¹æ³•**  
| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `Promise.resolve(value)` | è¿”å›ä¸€ä¸ªå·²æˆåŠŸçš„ Promise |
| `Promise.reject(error)` | è¿”å›ä¸€ä¸ªå·²å¤±è´¥çš„ Promise |
| `Promise.all([p1, p2, p3])` | **æ‰€æœ‰æˆåŠŸæ‰æˆåŠŸ**ï¼Œä»»ä¸€å¤±è´¥åˆ™æ•´ä½“å¤±è´¥ |
| `Promise.race([p1, p2])` | **ç¬¬ä¸€ä¸ªå®Œæˆï¼ˆæ— è®ºæˆåŠŸ/å¤±è´¥ï¼‰çš„ Promise å†³å®šç»“æœ** |
| `Promise.allSettled([p1, p2])` | **æ‰€æœ‰ Promise å®Œæˆï¼ˆæ— è®ºæˆåŠŸ/å¤±è´¥ï¼‰æ‰è¿”å›** |
| `Promise.any([p1, p2])` | **ç¬¬ä¸€ä¸ªæˆåŠŸçš„ Promise å†³å®šç»“æœ**ï¼Œå…¨éƒ¨å¤±è´¥æ‰å¤±è´¥ |

**ç¤ºä¾‹ï¼š`Promise.all`ï¼ˆå¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼‰**  
```javascript
const p1 = fetch("/api/data1");
const p2 = fetch("/api/data2");

Promise.all([p1, p2])
  .then(([res1, res2]) => console.log(res1, res2))
  .catch(error => console.error("è‡³å°‘ä¸€ä¸ªè¯·æ±‚å¤±è´¥:", error));
```


## **5. ä¸ async/await ç»“åˆ**  
`async/await` æ˜¯ Promise çš„è¯­æ³•ç³–ï¼Œè®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼š  
```javascript
async function fetchData() {
  try {
    const response = await fetch("/api/data"); // ç­‰å¾… Promise å®Œæˆ
    const data = await response.json();
    console.log(data);
  } catch (error) {
    console.error("è¯·æ±‚å¤±è´¥:", error);
  }
}
fetchData();
```


## **6. å¸¸è§é—®é¢˜**  
### **Q1: Promise å’Œå›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**  
âœ… **Promise ä¼˜ç‚¹**ï¼š
- é¿å…å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰ï¼Œä»£ç æ›´æ‰å¹³åŒ–ã€‚  
- æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œé”™è¯¯å¤„ç†æ›´é›†ä¸­ï¼ˆ`.catch`ï¼‰ã€‚  
- æä¾› `Promise.all`ã€`Promise.race` ç­‰é«˜çº§å¹¶å‘æ§åˆ¶ã€‚  

### **Q2: `new Promise` å’Œ `Promise.resolve` çš„åŒºåˆ«ï¼Ÿ**  
- `new Promise` ç”¨äºåˆ›å»ºæ–°çš„ Promiseã€‚  
- `Promise.resolve` ç›´æ¥è¿”å›ä¸€ä¸ªå·²æˆåŠŸçš„ Promiseã€‚  

### **Q3: å¦‚ä½•å–æ¶ˆ Promiseï¼Ÿ**  
Promise **æœ¬èº«ä¸æ”¯æŒå–æ¶ˆ**ï¼Œä½†å¯ä»¥é€šè¿‡ `AbortController`ï¼ˆç”¨äº `fetch`ï¼‰æˆ–ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `axios` çš„ `CancelToken`ï¼‰å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚  


## **æ€»ç»“**  
| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **çŠ¶æ€** | Pending â†’ Fulfilled / Rejected |
| **é“¾å¼è°ƒç”¨** | `.then().catch().finally()` |
| **é™æ€æ–¹æ³•** | `all`ã€`race`ã€`allSettled`ã€`any` |
| **async/await** | æ›´ç›´è§‚çš„å¼‚æ­¥å†™æ³• |

Promise æ˜¯ç°ä»£ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒï¼ŒæŒæ¡å®ƒæ‰èƒ½æ›´å¥½åœ°ä½¿ç”¨ `async/await` å’Œé«˜çº§å¼‚æ­¥æ§åˆ¶ï¼ ğŸš€ 
