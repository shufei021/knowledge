# 前端缓存

## 定义
前端缓存是 指浏览器通过存储资源（如 HTML、CSS、JS、图片等）来减少重复请求、加快页面加载速度的一种机制。合理使用缓存可以显著提升用户体验并降低服务器压力。前端缓存分为http缓存 和本地缓存

## http缓存: 有强缓存 和 协商缓存

+ 强缓存：Expiress：xx 和 Cache-control：max-age：xx，Expires 由于依赖用户的本地时间已经被废弃

+ 协商缓存：Last-Modfied / If-Modfied-Since（弊端有2：文件修改时间是秒。毫秒级无感、文件内容不动，文件名改了再改回去也不会返回缓存）、ETag/If-None-Match

```bash
// 协商缓存先决条件
Cache-control：no-cache
// 或
Cache-control：max-age:0,must-revalidate

```

#### 缓存流程图（浏览器视角）
```bash
是否有强缓存？
     ↓ 是
使用缓存（200 from memory/disk cache）
     ↓ 否
发送请求到服务器
     ↓
服务器检查协商缓存（If-Modified-Since / If-None-Match）
     ↓ 匹配成功
返回 304，使用缓存
     ↓ 不匹配
返回 200 和新资源
```

强缓存优先级更高，只有当它失效后才会走协商缓存。

#### 常见组合使用方式
| 强缓存策略	| 使用字段 |
| --- | --- |
|缓存策略	|使用字段|
|强缓存优先|	Cache-Control: max-age=xxx|
|强缓存 + 协商缓存|	Cache-Control: no-cache + ETag / Last-Modified|
|禁止缓存	|Cache-Control: no-store|
|CDN 缓存|	Cache-Control: public, max-age=xxx|

## 本地缓存：sessionStorage、localStorage、IndexDB、cookie

+ `sessionStorage`：会话缓存，窗口关闭，缓存随机销毁，大小一般再5M
+ `localStorage`：域名下的持久缓存，不主动删除就一直存在，封装需要过期机制，大小一般再5M
+ `IndexDB`：非关系性数据库，缓存大数据较好
+ `cookie`：缓存较小，一般是5k左右，常用缓存用户信息

